<!DOCTYPE html><html lang="en"><head></head><body><%-include("./commonJs.html")%><%-include("./commonCss.html")%><title>方案列表</title><link rel="stylesheet" href="<%=localurl%><%=projectUrl%>stylesheets/page/plan.css"><script type="text/babel">$(document).ready(function(){ function isWeixinBrowser() { var agent = navigator.userAgent.toLowerCase(); if (agent.match(/MicroMessenger/i) == "micromessenger") { return true; } else { return false; } }; const shark = new SharkTip({ needShark: true}); const loader = new Loaders({style:"rectangle"}); let updownloading = new Updownloading({ outerScroller: '.bodyOuterScroller', scroll: '.scroll', downLoadingStatus:false, upLoadingStatus:true, upFinish:"我也是有底线的", downFinish:"向上滑动加载更多", resistance:0.7, upFunction:readd });   var pageIndex = 1; function readd() { loader.show(); var formData = new FormData(); formData.append("pageNum", pageIndex); $.ajax({ url: "<%=localurl%><%=projectUrl%>getList", type: 'POST', data: formData, async: true, cache: false, dataType: 'json', contentType: false, processData: false, success: (data) => { if (data.ret == "0") { $.each(data.list, (idx, obj) => { $('.bodyOuterScroller .scroll').append(`<div class="dataList" data-code="${obj.code}" data-url="${obj.url}"><div class="dataListTip ui-grid-a"><span class="dataListName ui-block-a">${obj.name}</span> <span class="dataListdetail ui-block-b"><span class="info" data-id="${obj.id}" data-value="${obj.qrCode}">二维码</span></span></div><div class="dataListIntroductionShort">${obj.introductionShort}</div><div class="dataListBottom ui-grid-a"><span class="dataListPrice ui-block-a">${obj.priceMin}<span class="unit">元起</span></span> <span class="dataListSalemanRate ui-block-b">推广费${obj.salemanRate=="0.00%"?"--":obj.salemanRate}</span></div></div>`); }); $('.bodyOuterScroller').css('max-height',$("body").height()-$(".header").height()-$(".bottomTag").height()+"px" ); $('.bodyOuterScroller').css('height',$('.bodyOuterScroller .scroll').css('height')); if(data.list && 10 > data.list.length) { console.log(data.list); updownloading.callUpFinish(); } pageIndex++; } else { shark.show(data.msg); setTimeout(function () { window.location.href = "<%=localurl%><%=projectUrl%>login"; },2000); updownloading.callUpFinish(); } },complete: function(data) { loader.hide(); }, error: (data) => { shark.show("系统异常,请联系管理员"); } }); } readd();  $(".scroll").on("vclick",".dataList",function (e) { e.preventDefault(); e.stopPropagation(); if(isWeixinBrowser()){ window.location.href= $(this).attr("data-url"); }else{ window.open( $(this).attr("data-url")); } }); $(".scroll").on("vclick",".dataList .dataListdetail" ,function (e) { e.preventDefault(); e.stopPropagation();  let thisJquery = this; let qrCodeUrl = $(thisJquery).find(".info").attr("data-value"); if(qrCodeUrl){ $("body").append(`<div id="screen"><img src="${qrCodeUrl}"> <span>请长按二维码进行分享或下载</span></div>`); }else{ loader.show(); let formData = new FormData(); formData.append("planId",$(thisJquery).find(".info").attr("data-id")); formData.append("qrCodeUrl" , $(thisJquery).parents(".dataList").attr("data-url")); $.ajax({ url: "<%= localurl %><%= projectUrl %>reCreatePlanQrCode", type: 'POST', data: formData, async: true, cache: false, dataType: 'json', contentType: false, processData: false, success: (data) => { if (data.ret == 0) { $(thisJquery).find(".info").attr("data-value",data.url); $("body").append(`<div id="screen"><img src="${data.url}"> <span>请长按二维码进行分享或下载</span></div>`); } else { shark.show(data.msg); } }, complete: function (data) { loader.hide(); }, error: (data) => { shark.show("系统异常,请联系管理员"); } }); } }); $("body").on("vclick","#screen , #screen img",function (e) { e.preventDefault(); e.stopPropagation(); $("#screen").remove(); }); $(".bottomTag").on("vclick", "span" ,function (e) { e.preventDefault(); let urlAction = $(this).attr("data-action"); if(urlAction){ window.location.href = urlAction; } }); });</script><div class="header"><span class="title">方案列表</span></div><div class="bodyContent"><div class="bodyOuterScroller"><div class="scroll"></div></div><div class="bottomTag ui-grid-a"><span class="ui-block-a active">方案列表</span> <span class="ui-block-b" data-action="<%=localurl%><%=projectUrl%>userCenter">个人中心</span></div></div></body></html>