<!DOCTYPE html>
<html lang="en">
<head>
    <%-include("./commonJs.html")%>
    <%-include("./commonCss.html")%>
    <title>方案列表展示</title>
    <link rel="stylesheet"  href="<%=localurl%><%=projectUrl%>stylesheets/page/plan.css" />
    <script type="text/babel">
		$(document).ready(function(){
			const shark = new SharkTip({ needShark: true});/*初始化弹窗*/
			const loader = new Loaders({style:"rectangle"});

			/*上拉加载逻辑*/
			/*************** start  ***************/
			var pageIndex = 1;
			function readd() {
				loader.show();
				var formData = new FormData();
				formData.append("pageNum", pageIndex);
				$.ajax({
					url:  "<%=localurl%><%=projectUrl%>getList",
					type: 'POST',
					data: formData,
					async: true,
					cache: false,
					dataType: 'json',
					contentType: false,
					processData: false,
					success: (data) => {
						if (data.ret == "0") {
							$.each(data.list, (idx, obj) => {
								$('.bodyOuterScroller .scroll').append(`
                                    <div class="dataList" data-code="${obj.code}">
                                        <div class="dataListTip ui-grid-a">
                                            <span class="dataListName ui-block-a">${obj.name}</span>
                                            <span class="dataListdetail ui-block-b"><span class="info">资料</span></span>
                                        </div>
                                        <div class="dataListIntroductionShort">${obj.introductionShort}</div>
                                        <div class="dataListBottom ui-grid-a">
                                            <span class="dataListPrice ui-block-a">${obj.priceMin}<span class="unit">元起</span></span>
                                            <span class="dataListSalemanRate ui-block-b">推广费${obj.salemanRate}</span>
                                        </div>
                                    </div>
                                `);
							});

							$('.bodyOuterScroller').css('height',$('.bodyOuterScroller .scroll').css('height'));
							if(data.list &&  10 > data.list.length) {
								console.log(data.list);
								updownloading.upFinish();
							}
							pageIndex++;
						} else {
							shark.show(data.msg);
							setTimeout(function () {
                                window.location.href = "<%=localurl%><%=projectUrl%>login";
							},2000);
							updownloading.upFinish();
						}

					},complete: function(data) {
						loader.hide();
					},
					error: (data) => {
						shark.show("系统异常,请联系管理员");
					}
				});
			}
			readd();
			updownloading.init({
				outerScroller: '.bodyOuterScroller',
				downLoadingStatus:false,
				upLoadingStatus:true,
				downFinish:"我也是有底线的",
				upFinish :"向上滑动加载更多",
				upFunction:readd
			});
			/*************** end  ***************/
		});
    </script>
</head>
<body>
<div class="header">
    <span class="icon-carat-b-onwer backIcon" ></span>
    <span class="title">方案列表展示</span>
</div>
<div class="bodyContent">
    <div class="bodyOuterScroller">
        <div class = 'scroll'>
        </div>
    </div>
</div>
</body>
</html>